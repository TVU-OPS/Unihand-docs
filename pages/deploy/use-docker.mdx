import { Table, Td, Th, Tr } from "nextra/components";
import { Steps } from "nextra/components";

# **Triá»ƒn khai dá»± Ã¡n sá»­ dá»¥ng Docker Compose**

## ğŸ› ï¸ YÃªu cáº§u há»‡ thá»‘ng

- **Há»‡ Ä‘iá»u hÃ nh:** Ubuntu Server 20.04
- **Git:** phiÃªn báº£n má»›i nháº¥t, chi tiáº¿t vÃ  cÃ i Ä‘áº·t trÃªn trang chá»§ [Git](https://git-scm.com).
- **NodeJS:** phiÃªn báº£n 20 trá»Ÿ lÃªn, chi tiáº¿t vÃ  cÃ i Ä‘áº·t trÃªn [NodeJS Download Package Manager](https://nodejs.org/en/download/package-manager).
- **Docker vÃ  Docker Compose:** chi tiáº¿t vÃ  cÃ i Ä‘áº·t trÃªn trang chá»§ [Docker](https://www.docker.com).
- Xem thÃªm cÃ¡c cÃ´ng cá»¥ khÃ¡c náº¿u báº¡n muá»‘n tham gia phÃ¡t triá»ƒn dá»± Ã¡n táº¡i [UniHand Documentation](https://docs.unihand.site/getting-started/environment-software)

## CÃ i Ä‘áº·t Docker vÃ  Docker Compose

<Steps>

### CÃ i Ä‘áº·t Docker

- Cáº­p nháº­t danh sÃ¡ch package:

```bash copy
sudo apt update
```

- CÃ i Ä‘áº·t cÃ¡c gÃ³i phá»¥ thuá»™c:

```bash copy
sudo apt install apt-transport-https ca-certificates curl software-properties-common
```

- ThÃªm khÃ³a GPG cho kho Docker:

```bash copy
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
```

- ThÃªm kho Docker vÃ o nguá»“n APT:

```bash copy
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"
```

- Äáº£m báº£o báº¡n sáº¯p cÃ i Ä‘áº·t tá»« repo Docker thay vÃ¬ repo Ubuntu máº·c Ä‘á»‹nh:

```bash copy
apt-cache policy docker-ce
```

- Báº¡n sáº½ tháº¥y káº¿t quáº£ nhÆ° tháº¿ nÃ y, máº·c dÃ¹ sá»‘ phiÃªn báº£n cá»§a Docker cÃ³ thá»ƒ khÃ¡c:

```bash copy /5:19.03.9~3-0~ubuntu-focal/
docker-ce:
  Installed: (none)
  Candidate: 5:19.03.9~3-0~ubuntu-focal
  Version table:
     5:19.03.9~3-0~ubuntu-focal 500
        500 https://download.docker.com/linux/ubuntu focal/stable amd64 Packages
```

- CÃ i Ä‘áº·t Docker:

```bash copy
sudo apt install docker-ce
```

- Sau khi cÃ i Ä‘áº·t xong Docker, kiá»ƒm tra tráº¡ng thÃ¡i cá»§a Docker:

```bash copy
sudo systemctl status docker
```

- Káº¿t quáº£ pháº£i tÆ°Æ¡ng tá»± nhÆ° sau, cho tháº¥y Docker Ä‘ang hoáº¡t Ä‘á»™ng vÃ  Ä‘ang cháº¡y:

```bash /active/
Outputâ— docker.service - Docker Application Container Engine
     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
     Active: active (running) since Tue 2020-05-19 17:00:41 UTC; 17s ago
TriggeredBy: â— docker.socket
       Docs: https://docs.docker.com
   Main PID: 24321 (dockerd)
      Tasks: 8
     Memory: 46.4M
     CGroup: /system.slice/docker.service
             â””â”€24321 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
```

### CÃ i Ä‘áº·t Docker Compose

- Lá»‡nh sau sáº½ táº£i xuá»‘ng Docker Compose phiÃªn báº£n `1.29.2` vÃ  lÆ°u tá»‡p thá»±c thi táº¡i `/usr/local/bin/docker-compose`:

```bash copy
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
```

- Cáº¥p quyá»n Ä‘á»ƒ lá»‡nh `docker-compose` cÃ³ thá»ƒ thá»±c thi Ä‘Æ°á»£c:

```bash copy
sudo chmod +x /usr/local/bin/docker-compose
```

- Äá»ƒ kiá»ƒm tra Docker Compose Ä‘Ã£ cÃ i Ä‘áº·t thÃ nh cÃ´ng hay cháº¡y lá»‡nh:

```bash copy
docker-compose --version
```

- Báº¡n sáº½ tháº¥y káº¿t quáº£ tÆ°Æ¡ng tá»± tháº¿ nÃ y:

```bash /1.29.2/
Output
docker-compose version 1.29.2, build 5becea4c
```

</Steps>

## ğŸ’» Triá»ƒn khai há»‡ thá»‘ng

<Steps>

### Clone dá»± Ã¡n

```bash copy
git clone https://github.com/TVU-OPS/UniHand.git
```

### Di chuyá»ƒn vÃ o thÆ° má»¥c dá»± Ã¡n

```bash copy
cd UniHand
```

### Khá»Ÿi táº¡o cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t

```bash copy
npm run genv
```
- Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i IP hoáº·c tÃªn miá»n thÃ nh IP hoáº·c tÃªn miá»n server cá»§a báº¡n trong tá»‡p tin **.env** há»‡ thá»‘ng vá»«a táº¡o tÆ°Æ¡ng á»©ng vá»›i hai biáº¿n mÃ´i trÆ°á»ng **HOME_DOMAIN** vÃ  **ADMIN_DOMAIN**.


### Build vÃ  cháº¡y dá»± Ã¡n

```bash copy
docker compose up -d
```

</Steps>

#### CÃ¡c Port há»‡ thá»‘ng sá»­ dá»¥ng sau khi Ä‘Ã£ cháº¡y thÃ nh cÃ´ng

<Table>
  <thead>
    <Tr>
      <Th>Container</Th>
      <Th>Port</Th>
      <Th>MÃ´ táº£</Th>
    </Tr>
  </thead>
  <tbody>
    <Tr>
      <Td>mysql-server</Td>
      <Td>3306:3306</Td>
      <Td>Server há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u MySQL</Td>
    </Tr>
    <Tr>
      <Td>server-strapi</Td>
      <Td>1337:1337</Td>
      <Td>
        Server API, sá»­ dá»¥ng <span style={{ fontWeight: "bold" }}>Strapi</span>
      </Td>
    </Tr>
    <Tr>
      <Td>web-home</Td>
      <Td>82:80</Td>
      <Td>
        Trang chá»§, sá»­ dá»¥ng <span style={{ fontWeight: "bold" }}>Noodl</span>
      </Td>
    </Tr>
    <Tr>
      <Td>web-admin</Td>
      <Td>81:80</Td>
      <Td>
        Trang quáº£n trá»‹, sá»­ dá»¥ng <span style={{ fontWeight: "bold" }}>Noodl</span>
      </Td>
    </Tr>
    <Tr>
      <Td>domain</Td>
      <Td>80:80</Td>
      <Td>
        Proxy domain Ä‘áº¿n Trang chá»§ vÃ  Trang quáº£n trá»‹, sá»­ dá»¥ng{" "}
        <span style={{ fontWeight: "bold" }}>Nginx</span>
      </Td>
    </Tr>
  </tbody>
</Table>
